GEN_PROMPT_TEMPLATE = (
    "You are a data-to-text author. Your task is to write exactly one natural-language question by first reasoning using the steps below and then writing the question.\n"
    "The final question should be correctly answered by executing the given SQL on the given schema.\n\n"
    "Inputs:\n- SQL:\n"
    "{sql}\n\n"
    "Work in short, auditable steps. Do not reveal the SQL verbatim in the final question.\n\n"
    "Steps:\n"
    "1) Parse the SQL intent\n"
    "   - Identify the main operation (SELECT, INSERT, UPDATE, etc.)\n"
    "   - Summarize what each clause or keyword does (filters, grouping, ordering, limits, joins)\n"
    "   - Note logical connectors, subqueries, or set operations that affect meaning\n"
    "   - Keep your answer to 1-2 sentences!\n"
    "2) Map schema semantics\n"
    "   - Convert column and table names into human concepts\n"
    "   - Keep domain units and time ranges explicit\n"
    "   - Keep your answer to 1 sentence!\n"
    "3) Draft the question\n"
    "   - Ask for exactly the projected information\n"
    "   - Keep the sentences natural and human-like\n"
    "   - Keep your answer to 1 sentences!\n"
    "4) Validate\n"
    "   - The question must be answerable by this SQL\n"
    "   - No extra fields not selected by the SQL\n"
    "   - No SQL jargon, no code, no table or column names unless they are human-facing labels\n\n"
    "   - Keep your answer to 1-2 sentences!\n"
    "Output format:\n"
    "<think>follow the steps above. Keep your answer to each step brief</think>\n"
    "<question>the final natural-language question in one sentence</question>\n"
    "Constraints:\n- Output only in the format above\n- Do not include any explanation outside the tags. Your reasoning should be no more than 5 sentences! Responses that are too long will be penalized."
)

VAL_PROMPT_TEMPLATE = (
    "You are an expert evaluator of reasoning chains (CoT) that explain how a SQL query is translated into natural language (NL).\n\n"
    "You will be given:\n"
    "  - a SQL query,\n"
    "  - a reasoning chain (CoT) that describes how the SQL maps to NL,\n"
    "  - and the final NL sentence itself.\n\n"
    "Your goal is to judge how accurate and complete the reasoning is, and how well it justifies the NL sentence.\n\n"
    "Focus on the following evaluation criteria:\n"
    "1. Faithfulness – Does the reasoning correctly represent the logic of the SQL? Are all filters, aggregations, and clauses described accurately without hallucination?\n"
    "2. Completeness – Does the reasoning mention every major SQL component (SELECT, WHERE, GROUP BY, ORDER BY, HAVING, etc.) that contributes to the NL meaning?\n"
    "3. Error Diagnosis – If parts of the SQL are missing or incorrect in the reasoning or NL, explicitly identify them.\n"
    "4. Final Coherence – Is the reasoning internally consistent and does it lead naturally to a justified numeric score?\n\n"
    "After evaluating, assign a final numeric score between 0 and 1 reflecting the overall validity and quality of the reasoning.\n"
    "A perfect match (faithful, complete, no errors) should score close to 1.0; major logical errors or omissions should score near 0.0.\n\n"
    "Be concise and to the point. Your reasoning should be no more than a few sentences.\n\n"
    "Output exactly in this format:\n\n"
    "<think>\n"
    "Step 1: Briefly summarize the SQL intent and structure.\n"
    "Step 2: Briefly evaluate the reasoning chain's accuracy and coverage.\n"
    "Step 3: Briefly compare the reasoning and SQL to the NL sentence.\n"
    "Step 4: Briefly diagnose any missing or incorrect logic.\n"
    "Step 5: Conclude with an overall justification for the score.\n"
    "</think>\n"
    "<score>\n0.87\n</score>\n"
    "Do not include any text after </score>.\n\n"
    "Here is the data:\n"
    "SQL Query: {sql}\n"
    "CoT: {cot}\n"
    "NL: {nl}\n"
)

